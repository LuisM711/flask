{% extends './layout.html' %}
{% block content %}
<div class="container">
    <h1>Modulo de mascotas</h1>

    <!-- Formulario para agregar mascota -->
    <h2>Agregar Mascota</h2>
    <form id="formAgregar" method="post" action="{{ url_for('mascotas_post') }}">
        <div class="mb-3">
            <label for="nombre">Nombre:</label>
            <input type="text" class="form-control" id="nombre" name="nombre" required>
        </div>
        <div class="mb-3">
            <label for="edad">Edad:</label>
            <input type="number" class="form-control" id="edad" name="edad" required>
        </div>
        <div class="mb-3">
            <label for="raza">Raza:</label>
            <input type="text" class="form-control" id="raza" name="raza" required>
        </div>
        <div class="mb-3">
            <label for="descripcion">Descripción:</label>
            <textarea class="form-control" id="descripcion" name="descripcion" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Agregar Mascota</button>
    </form>

    <!-- Lista de mascotas -->
    <h2>Listado de Mascotas</h2>
    <ul class="list-group" id="listaMascotas">
        {% for mascota in mascotas %}
            <li class="list-group-item">
                Nombre: {{ mascota.nombre }} Edad: {{ mascota.edad }} Raza: {{ mascota.raza }} Descripción: {{ mascota.descripcion }}
                <div class="btn-group" role="group" aria-label="Acciones">
                    <button type="button" class="btn btn-warning btnEditar" data-id="{{ mascota.id }}">Editar</button>
                    <button type="button" class="btn btn-danger btnBorrar" data-id="{{ mascota.id }}">Borrar</button>
                </div>
            </li>
        {% endfor %}
    </ul>
</div>

<script src="jquery.js" ></script>
<script>
    $(document).ready(function() {
        // Manejo de evento para agregar mascota
        $('#formAgregar').submit(function(event) {
            event.preventDefault();
            $.post($(this).attr('action'), $(this).serialize(), function(response) {
                alert(response.message);
                location.reload();
            });
        });

        // Manejo de evento para editar mascota
        $('.btnEditar').click(function() {
            let mascotaId = $(this).data('id');
            let nombre = prompt('Ingrese el nuevo nombre:');
            let edad = prompt('Ingrese la nueva edad:');
            let raza = prompt('Ingrese la nueva raza:');
            let descripcion = prompt('Ingrese la nueva descripción:');
            
            $.ajax({
                type: 'PUT',
                url: '/mascotas/' + mascotaId,
                data: {
                    nombre: nombre,
                    edad: edad,
                    raza: raza,
                    descripcion: descripcion
                },
                success: function(response) {
                    alert(response.message);
                    location.reload();
                }
            });
        });

        // Manejo de evento para borrar mascota
        $('.btnBorrar').click(function() {
            let mascotaId = $(this).data('id');
            if (confirm('¿Está seguro de que desea borrar esta mascota?')) {
                $.ajax({
                    type: 'DELETE',
                    url: '/mascotas/' + mascotaId,
                    success: function(response) {
                        alert(response.message);
                        location.reload();
                    }
                });
            }
        });
    });
</script>
{% endblock %}
