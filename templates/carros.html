{% extends './layout.html' %}
{% block content %}
<div class="container">
    <h1>Modulo de carros</h1>

    <!-- Formulario para agregar carro -->
    <h2>Agregar Carro</h2>
    <form id="formAgregar" method="post" action="{{ url_for('carros_post') }}">
        <div class="mb-3">
            <label for="marca">Marca:</label>
            <input type="text" class="form-control" id="marca" name="marca" required>
        </div>
        <div class="mb-3">
            <label for="modelo">Modelo:</label>
            <input type="text" class="form-control" id="modelo" name="modelo" required>
        </div>
        <div class="mb-3">
            <label for="año">Año:</label>
            <input type="number" class="form-control" id="año" name="año" required>
        </div>
        <button type="submit" class="btn btn-primary">Agregar Carro</button>
    </form>

    <!-- Lista de carros -->
    <h2>Listado de Carros</h2>
    <ul class="list-group" id="listaCarros">
        {% for carro in carros %}
            <li class="list-group-item">
                {{ carro.marca }} - Modelo: {{ carro.modelo }} - Año: {{ carro.año }}
                <div class="btn-group" role="group" aria-label="Acciones">
                    <button type="button" class="btn btn-warning btnEditar" data-id="{{ carro.id }}">Editar</button>
                    <button type="button" class="btn btn-danger btnBorrar" data-id="{{ carro.id }}">Borrar</button>
                </div>
            </li>
        {% endfor %}
    </ul>
</div>

<script src="jquery.js"></script>
<script>
    $(document).ready(function() {
        // Manejo de evento para agregar carro
        $('#formAgregar').submit(function(event) {
            event.preventDefault();
            $.post($(this).attr('action'), $(this).serialize(), function(response) {
                alert(response.message);
                location.reload();
            });
        });

        // Manejo de evento para editar carro
        $('.btnEditar').click(function() {
            var carroId = $(this).data('id');
            var marca = prompt('Ingrese la nueva marca:');
            var modelo = prompt('Ingrese el nuevo modelo:');
            var año = prompt('Ingrese el nuevo año:');
            
            $.ajax({
                type: 'PUT',
                url: '/carros/' + carroId,
                data: {
                    marca: marca,
                    modelo: modelo,
                    año: año
                },
                success: function(response) {
                    alert(response.message);
                    location.reload();
                }
            });
        });

        // Manejo de evento para borrar carro
        $('.btnBorrar').click(function() {
            var carroId = $(this).data('id');
            if (confirm('¿Está seguro de que desea borrar este carro?')) {
                $.ajax({
                    type: 'DELETE',
                    url: '/carros/' + carroId,
                    success: function(response) {
                        alert(response.message);
                        location.reload();
                    }
                });
            }
        });
    });
</script>
{% endblock %}
